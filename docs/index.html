<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>nenesub: Nearest-neighbors subsampling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">nenesub
   </div>
   <div id="projectbrief">Nearest neighbors subsampling</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Nearest-neighbors subsampling </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a> <img src="https://github.com/libscran/nenesub/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/libscran/nenesub/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/libscran/nenesub"><img src="https://codecov.io/gh/libscran/nenesub/graph/badge.svg?token=bmenggvgzE" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1>Overview</h1>
<p><b>nenesub</b> implements a simple algorithm for deterministic subsampling of a dataset based on nearest neighbors. Starting from dense regions of the high-dimensional space, we select an observation for inclusion into the subsampled set. Every time we select an observation, we remove it and all of its nearest neighbors from the dataset. We then select the next observation with the most remaining neighbors, with ties broken by density; this is repeated until there are no more observations.</p>
<p>The general idea is that each selected observation serves as a representative for its nearest neighbors. This ensures that the subsampled points are well-distributed across the dataset. Low-frequency subpopulations will always have at least a few representatives if they are sufficiently distant from other subpopulations. We also preserve the relative density across the dataset as more representatives will be generated from high-density regions.</p>
<h1>Quick start</h1>
<p>Given a column-major array of coordinates (typically in some <a href="https://github.com/libscran/scran_pca">low-dimensional space</a>), we can subsample the observations:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="nenesub_8hpp.html">nenesub/nenesub.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">size_t</span> nobs = 1000;</div>
<div class="line"><span class="keywordtype">size_t</span> ndims = 100;</div>
<div class="line">std::vector&lt;double&gt; coordinates(ndims * ncells);</div>
<div class="line"><span class="comment">// Fill it with some coordinates...</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structnenesub_1_1Options.html">nenesub::Options</a> opt;</div>
<div class="line">opt.<a class="code hl_variable" href="structnenesub_1_1Options.html#a5df6fdc7c00d5560cf24e707c6d2a318">num_neighbors</a> = 20;</div>
<div class="line">opt.<a class="code hl_variable" href="structnenesub_1_1Options.html#aca8e07989de02b7fc173848333a93695">min_remaining</a> = 10;</div>
<div class="line">opt.<a class="code hl_variable" href="structnenesub_1_1Options.html#a97589522562c135c803914e6e4abdecc">num_threads</a> = 3;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> selected = <a class="code hl_function" href="namespacenenesub.html#a38e855459f3bf52b4248a40e73a27129">nenesub::compute</a>(</div>
<div class="line">    ndims,</div>
<div class="line">    ncells,</div>
<div class="line">    coordinates.data(),</div>
<div class="line">    <a class="code hl_classRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1VptreeBuilder.html">knncolle::VptreeBuilder&lt;&gt;</a>(), <span class="comment">// any NN algorithm can be used here.</span></div>
<div class="line">    opt</div>
<div class="line">);</div>
<div class="ttc" id="aclassknncolle_1_1VptreeBuilder_html"><div class="ttname"><a href="https://knncolle.github.io/knncolle/classknncolle_1_1VptreeBuilder.html">knncolle::VptreeBuilder</a></div></div>
<div class="ttc" id="anamespacenenesub_html_a38e855459f3bf52b4248a40e73a27129"><div class="ttname"><a href="namespacenenesub.html#a38e855459f3bf52b4248a40e73a27129">nenesub::compute</a></div><div class="ttdeci">void compute(Index_ num_obs, GetNeighbors_ get_neighbors, GetIndex_ get_index, GetMaxDistance_ get_max_distance, const Options &amp;options, std::vector&lt; Index_ &gt; &amp;selected)</div><div class="ttdef"><b>Definition</b> nenesub.hpp:84</div></div>
<div class="ttc" id="anenesub_8hpp_html"><div class="ttname"><a href="nenesub_8hpp.html">nenesub.hpp</a></div><div class="ttdoc">Nearest-neighbors subsampling.</div></div>
<div class="ttc" id="astructnenesub_1_1Options_html"><div class="ttname"><a href="structnenesub_1_1Options.html">nenesub::Options</a></div><div class="ttdoc">Options for compute().</div><div class="ttdef"><b>Definition</b> nenesub.hpp:24</div></div>
<div class="ttc" id="astructnenesub_1_1Options_html_a5df6fdc7c00d5560cf24e707c6d2a318"><div class="ttname"><a href="structnenesub_1_1Options.html#a5df6fdc7c00d5560cf24e707c6d2a318">nenesub::Options::num_neighbors</a></div><div class="ttdeci">int num_neighbors</div><div class="ttdef"><b>Definition</b> nenesub.hpp:30</div></div>
<div class="ttc" id="astructnenesub_1_1Options_html_a97589522562c135c803914e6e4abdecc"><div class="ttname"><a href="structnenesub_1_1Options.html#a97589522562c135c803914e6e4abdecc">nenesub::Options::num_threads</a></div><div class="ttdeci">int num_threads</div><div class="ttdef"><b>Definition</b> nenesub.hpp:43</div></div>
<div class="ttc" id="astructnenesub_1_1Options_html_aca8e07989de02b7fc173848333a93695"><div class="ttname"><a href="structnenesub_1_1Options.html#aca8e07989de02b7fc173848333a93695">nenesub::Options::min_remaining</a></div><div class="ttdeci">int min_remaining</div><div class="ttdef"><b>Definition</b> nenesub.hpp:37</div></div>
</div><!-- fragment --><p>We can also supply a precomputed list of neighbors.</p>
<div class="fragment"><div class="line"><span class="comment">// Getting the nearest neighbors:</span></div>
<div class="line"><a class="code hl_classRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1VptreeBuilder.html">knncolle::VptreeBuilder</a> algorithm;</div>
<div class="line"><a class="code hl_classRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1SimpleMatrix.html">knncolle::SimpleMatrix</a> kmatrix(nobs, ndims, coordinates.data());</div>
<div class="line"><span class="keyword">auto</span> prebuilt = algorithm.<a class="code hl_functionRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1Builder.html#afeda432debae999f988f32f147055251">build_unique</a>(kmatrix);</div>
<div class="line"><span class="keyword">auto</span> neighbors = knncolle::find_neighbors(prebuilt);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> compute = <a class="code hl_function" href="namespacenenesub.html#a38e855459f3bf52b4248a40e73a27129">nenesub::compute</a>(neighbors, opt);</div>
<div class="ttc" id="aclassknncolle_1_1Builder_html_afeda432debae999f988f32f147055251"><div class="ttname"><a href="https://knncolle.github.io/knncolle/classknncolle_1_1Builder.html#afeda432debae999f988f32f147055251">knncolle::Builder::build_unique</a></div><div class="ttdeci">std::unique_ptr&lt; Prebuilt&lt; typename Matrix_::dimension_type, typename Matrix_::index_type, Float_ &gt; &gt; build_unique(const Matrix_ &amp;data) const</div></div>
<div class="ttc" id="aclassknncolle_1_1SimpleMatrix_html"><div class="ttname"><a href="https://knncolle.github.io/knncolle/classknncolle_1_1SimpleMatrix.html">knncolle::SimpleMatrix</a></div></div>
</div><!-- fragment --><p>Check out the <a href="https://libscran.github.io/nenesub">reference documentation</a> for more details.</p>
<h1>Building projects</h1>
<h2>CMake with <code>FetchContent</code></h2>
<p>If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  nenesub</div>
<div class="line">  GIT_REPOSITORY https://github.com/libscran/nenesub</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(nenesub)</div>
</div><!-- fragment --><p>Then you can link to <b>nenesub</b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe libscran::nenesub)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE libscran::nenesub)</div>
</div><!-- fragment --><h2>CMake with <code>find_package()</code></h2>
<div class="fragment"><div class="line">find_package(libscran_nenesub CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE libscran::nenesub)</div>
</div><!-- fragment --><p>To install the library, use:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DNENESUB_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p>By default, this will use <code>FetchContent</code> to fetch all external dependencies. If you want to install them manually, use <code>-DNENESUB_FETCH_EXTERN=OFF</code>. See the tags in <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a> to find compatible versions of each dependency.</p>
<h2>Manual</h2>
<p>If you're not using CMake, the simple approach is to just copy the files in <code>include/</code> - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. This requires the external dependencies listed in <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a>, which also need to be made available during compilation. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
